#!/bin/bash

OS="$(uname)"
APP=""

case "$OS" in
  Darwin*)
    ARCH="$(uname -m)"
    if [[ "$ARCH" == "arm64" ]]; then
      APP="./ReleaseNotesApp/ReleaseNotes-darwin-arm64/ReleaseNotes.app/Contents/MacOS/ReleaseNotes"
    else
      APP="./ReleaseNotesApp/ReleaseNotes-darwin-x64/ReleaseNotes.app/Contents/MacOS/ReleaseNotes"
    fi
    ;;
  Linux*)
    APP="./ReleaseNotesApp/ReleaseNotes-linux-x64/ReleaseNotes"
    ;;
  MINGW*|CYGWIN*|MSYS*)
    APP="./ReleaseNotesApp/ReleaseNotes-win32-x64/ReleaseNotes.exe"
    ;;
  *)
    echo "Sistema operativo non supportato"
    exit 1
    ;;
esac

# Avvia l'app e aspetta che termini
"$APP"

# Verifica file release_notes.json nella root repo
NOTES_FILE="release_notes.json"

if [ ! -f "$NOTES_FILE" ]; then
  echo "❌ Release notes mancanti. Commit annullato."
  exit 1
fi

git add "$NOTES_FILE"

echo "✅ Release notes compilate e aggiunte. Commit consentito."

exit 0
