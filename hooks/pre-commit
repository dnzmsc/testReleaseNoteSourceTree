#!/bin/bash

SCRIPT="release_notes_form/release_notes_gui.py"
FILE="release_notes.json"

# Avvia la GUI Python
python3 "$SCRIPT"

# Verifica presenza file
if [ ! -f "$FILE" ]; then
  echo "❌ File release_notes.json mancante."
  exit 1
fi

# Verifica data dell'ultima release
LAST_DATE=$(python3 -c "
import json
with open('$FILE') as f:
    data = json.load(f)
print(data['releases'][-1]['data'])
")

if [ "$LAST_DATE" == "1970-01-01" ] || [ -z "$LAST_DATE" ]; then
  echo "❌ Data non valida nella release note ($LAST_DATE). Commit annullato."
  exit 1
fi

git add "$FILE"
echo "✅ Release note OK e aggiunta al commit."
